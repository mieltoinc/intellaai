---
title: "SandboxAgent"
description: "Create sandboxes and optional sessions in one flow with SandboxAgent from Intella"
---

**SandboxAgent** is the recommended way to use Intella. It combines sandbox creation, optional agent setup, and session creation in one flow—so you avoid wiring the sandbox, Redis, session, and agent yourself.

Use it when you want a single entry point to spin up a sandbox and, optionally, a session (with post-create setup like `runCmd`, `gitClone`, `npmInstall`), then execute tasks and stream events.

## Prerequisites

- **REDIS_URL** — e.g. `redis://localhost:6379` (injected into the sandbox env).
- **E2B** (if using E2B sandbox): `E2B_API_KEY`.
- **Session/agent**: `ANTHROPIC_API_KEY`, `OPENAI_API_KEY` as needed (in sandbox env or passed in `apiKeys`).

## API overview

| Method | Purpose |
|--------|--------|
| `SandboxAgent.createSandboxAgent(options)` | Create and initialize a sandbox only. Returns `ISandboxProvider`. |
| `SandboxAgent.connect(options)` | Create sandbox + optional session; returns a `SandboxAgent` instance with `sandbox`, `session` (and optionally `agent`) set. |
| `instance.init(options?)` | Initialize (or re-init) sandbox and optional session. |
| `instance.endSession()` | End the current session if any. |
| `instance.close()` | Close sandbox and clear references. |

## Options (SandboxAgentOptions)

<ResponseField name="redisUrl" type="string" required>
  Redis URL injected into the sandbox env as `REDIS_URL`. Used for session and command streaming (e.g. `redis://localhost:6379`).
</ResponseField>

<ResponseField name="sandbox" type="object" required>
  Sandbox provider and config.

  <Expandable title="Sandbox config">
    <ResponseField name="provider" type="SandboxProviderType" required>
      One of: `LOCAL`, `E2B`, `DAYTONA`, `MODAL`, `VERCEL`.
    </ResponseField>
    <ResponseField name="config" type="SandboxConfig">
      Optional. `env`, `templateId`, `timeout`, `cwd`, and provider-specific options.
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="agent" type="object">
  Optional. Used when creating a session. `type`: `AgentType` (e.g. `CLAUDE`, `CODEX`, `OPENCODE`), `config`: optional `AgentConfig` (e.g. `model`, `mcpServers`).
</ResponseField>

<ResponseField name="session" type="object">
  Optional. If present, `init()` / `connect()` create a session. `sessionId`: optional string; `postCreate`: optional `SessionInitSetup` (e.g. `runCmd`, `gitClone`, `npmInstall`).
</ResponseField>

## Sandbox only

Create a sandbox, run a command, then close. No session or agent.

```typescript
import { SandboxAgent, SandboxProviderType } from 'intella';

const sandbox = await SandboxAgent.createSandboxAgent({
  redisUrl: process.env.REDIS_URL!,
  sandbox: {
    provider: SandboxProviderType.LOCAL,
    config: { env: {} },
  },
});

await sandbox.executeCommand('echo hi');
await sandbox.close();
```

## Sandbox + session

Create a sandbox and a session (with optional post-create setup). Use **SandboxAgent.connect** and pass `agent` and `session`.

```typescript
import { SandboxAgent, SandboxProviderType, AgentType } from 'intella';

const sa = await SandboxAgent.connect({
  redisUrl: process.env.REDIS_URL!,
  sandbox: {
    provider: SandboxProviderType.LOCAL,
    config: {
      templateId: 'intella-sdk',
      env: { REDIS_URL: process.env.REDIS_URL },
    },
  },
  agent: {
    type: AgentType.CLAUDE,
    config: { model: 'sonnet' },
  },
  session: {
    sessionId: 'my-session',
    postCreate: {
      runCmd: [{ command: 'echo "ready"' }],
    },
  },
});

console.log(sa.session?.id);
await sa.endSession();
await sa.close();
```

## Execute task and stream

After connecting with a session, execute an agent task and stream response chunks:

```typescript
import { SandboxAgent, AgentType, SandboxProviderType, StreamEventType } from 'intella';

const sa = await SandboxAgent.connect({ redisUrl, sandbox: { ... }, agent: { ... }, session: { sessionId, ... } });
const sandbox = sa.sandbox!;
const sessionId = sa.session!.id;

const taskRequest = {
  sessionId,
  prompt: 'List files in the workspace.',
  agentType: AgentType.CLAUDE,
  model: 'sonnet',
};

for await (const chunk of sandbox.executeAgent(taskRequest, AgentType.CLAUDE, {
  apiKeys: { ANTHROPIC_API_KEY: process.env.ANTHROPIC_API_KEY ?? '' },
})) {
  if (chunk.chunk) process.stdout.write(chunk.chunk);
}
```

**TaskRequest** must include `sessionId` for `executeAgent`. Pass `apiKeys` so the agent can call the model from the sandbox.

Alternatively, use **publishCommand** + **streamEvents**: publish an `agent:execute` command, then consume the session or sandbox stream (see [Transport (Redis Stream)](/transport)).

## Streaming events

After connecting, you can stream session or sandbox events from the sandbox instance.

- **Session stream** — Agent text chunks, tool calls, etc. Use `sandbox.streamEvents(StreamEventType.SESSION, { sessionId, stopOnDone: true })`.
- **Sandbox command results** — Results for a specific command. Publish with `sandbox.publishCommand({ type: 'agent:execute', sessionId, data: taskRequest, ... })`, then stream with `sandbox.streamEvents(StreamEventType.SANDBOX, { commandId })`.

<Note>
  See [stream-events-usage.ts](https://github.com/snowphase/intella/blob/main/packages/intella-sdk/examples/sandbox-agent/stream-events-usage.ts) in the repo for a full example.
</Note>

## Prerequisites by provider

| Provider | Required |
|----------|----------|
| Local | `REDIS_URL`. For sessions: Intella CLI in sandbox (e.g. `templateId: 'intella-sdk'`), `ANTHROPIC_API_KEY` / `OPENAI_API_KEY` in sandbox env. |
| E2B | `E2B_API_KEY`, `REDIS_URL`. |
| Daytona | `DAYTONA_API_KEY`, `DAYTONA_API_URL`, `REDIS_URL`. |
| Session/agent | `ANTHROPIC_API_KEY`, `OPENAI_API_KEY` as needed (in sandbox env). |

## Key types

| Type | Description |
|------|-------------|
| `SandboxAgentOptions` | `redisUrl`, `sandbox`, `agent?`, `session?` |
| `StreamEventType.SESSION` | Stream agent text chunks from session stream |
| `StreamEventType.SANDBOX` | Stream command results (chunk, done, error) from sandbox stream |
| `TaskRequest` | Must include `sessionId` for `executeAgent` |
| `SandboxAgentStreamChunk` | `chunk?`, `isDone?`, `type?`, `data?` |
| `SandboxCommandResult` | `commandId`, `type`, `data?`, `error?` |

## Examples in the repo

Runnable examples are in the SDK package:

- **basic-usage.ts** — `createSandboxAgent` (sandbox only) and `connect` (sandbox + session).
- **local-usage.ts** — Local provider only; no API keys.
- **with-session-and-setup.ts** — `connect` with session and `postCreate` (runCmd, gitClone, autoInstall).
- **stream-events-usage.ts** — `connect` then `streamEvents` for session and sandbox streams.

Run from the SDK package: `npx tsx examples/sandbox-agent/<file>.ts`.
